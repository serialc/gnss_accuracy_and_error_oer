---
title: "GNSS/GPS precision and error"
author: "Sylvain Klein & Cyrille Médard de Chardon"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# GNSS precision & error

A Global Navigation Satellite System (GNSS), also commonly called a Global Positioning System (GPS) which is actually a brand of GNSS, are commonly believed to provide the best quality georeferencing of points. Georeferencing is the process of associating points on the surface of the Earth to a standardized coordinate system. This allows us to say the Eiffel Tower is located at 29.9792° N, 31.1342° E using the WGS 84 geographic coordinate system. This is typically just referred to as a latitude and longitude without any thought to what geographic coordinate system we are using. While coordinates can be [infinitely precise](https://xkcd.com/2170/) the question this resource aims to explore is how *accurate* are the devices that we use to record the coordinates.

A brief reminder of the difference between accuracy and precision:

| Value | Measurement | Definition |
|---|---|---|
|2.017|2.8325|Precise but not accurate|
|2.017|2|Accurate but not precise|
|2.017|2.017|Accurate and precise|
Note that it is better to be accurate rather than precise.

## Actual path
Below is a walk tour in Belval, starting next to the furnaces, going along the shopping center (Belval Plaza), then to the Park "Um Belval" on the west and ending in front of the Maison des Sciences Humaines (MSH). [Belval](https://www.luxatlas.lu/#b=2362&o=null&f=1071&ob=100&oo=100&of=50&x=662203&y=6360423&z=16.541415223113926). The path goes through a variety of  urban settings surrounded by tall structures and buildings, and open field area.

![Trace of a walk in Belval, Luxembourg](./images/BelvalWalk_trace.svg)
The trace (green lines) is digitized manually in QGIS.


## Sensed path - GNSS data

We captured the NMEA sentences with an App installed on the smartphone. 
The points where retrieved using a python script and mapped over the digitized trace of the walk.

Describe error over space-time

![Image of actual path and GNSS points](./images/BelvalWalk_trace with gps.svg)

```{r echo=FALSE, warning=FALSE}
library("stringr")
dferr <- read.table("./processing/trace_data/BelvalWT-snap-deviation.csv", sep = ",", header = T)
dferr[c("h", "m", "s")] <- str_split_fixed(dferr$time, ":",3)
dferr$ntime <- as.numeric(dferr$h) * 60 * 60 + as.numeric(dferr$m) * 60 + as.numeric(dferr$s )
mint <- min(dferr$ntime)
dferr$ntime <- dferr$ntime - mint
dfs <- read.table("./processing/trace_data/BelvalWT-snap-height_stats0.csv", sep = ",", header = T)
df <- merge(dferr, dfs[,c("rid", "X_count", "X_sum",  "X_mean", "X_median", "X_stdev", "X_min", "X_max")], by = "rid")
plot(df$ntime, df$deviation, type = "l", xlab = "Time (s)", ylab = "Deviation from trace (m)")

```

## 3D visualization - what causes error

We know that buildings interfere with GNSS precision - but let's create a map showing building heights with the paths overlayed.

[see GPS path and 3D buildings](https://map.geoportail.lu/theme/main?bgLayer=basemap_2015_global&version=3&zoom=14&X=661470&Y=6361338&lang=en&rotation=0&layers=&opacities=&crosshair=false&3d_layers=ACT2022_BD_L_BATI3D_LOD2%2CVDL2022_LOD2_IMPORT_old%2CBridges_LOD2%2CACT2019_LiDAR_Bridges_LOD1%2CACT2019_LiDAR_Vegetation&3d_enabled=true&3d_lon=5.94209&3d_lat=49.49240&3d_elevation=1385&3d_heading=360.000&3d_pitch=-40.388&map_id=3a4b6e155fce4f448337ebe41ed6c005&embedded=true)

The mean height 50 m around the points is now overlayed in red with the deviation in meter.

```{r echo=FALSE, warning=FALSE}
plot(df$ntime, df$deviation, type = "l", xlab = "Time (s)", ylab = "Deviation from trace (m)")
lines(df$ntime, df$X_mean, col="red")
```

Discuss whether we can see why the error is going in one way or the other.



## HDOP metric vs sat count vs ground-truthed error


## Comparison of errors (?) and wrap up



